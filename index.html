<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>My Little Game</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background-color: #111;
      color: white;
      margin: 0;
      padding: 1em;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }
    .settings label, .settings input {
      font-size: 1.2em;
      margin: 0.3em 0;
      display: block;
      width: 100%;
    }
    .settings input {
      padding: 0.5em;
    }
    .settings button {
      font-size: 1.2em;
      padding: 0.6em 1.2em;
      margin-top: 0.5em;
      width: 100%;
    }
    #progress-container {
      width: 100%;
      max-width: 500px;
      margin-top: 1em;
    }
    #progress {
      width: 100%;
      height: 40px;
      background: #555;
      border-radius: 20px;
      overflow: hidden;
      box-sizing: border-box;
    }
    #bar {
      height: 100%;
      width: 100%;
      background: green;
      transition: width 1s linear;
    }
    #status {
      font-size: 1.5em;
      margin-bottom: 1em;
    }
    #countdown {
      font-size: 2em;
      margin-top: 0.5em;
    }
    .hidden {
      display: none;
    }
    #auth-container input {
      padding: 0.8em;
      font-size: 1.2em;
      width: 100%;
      max-width: 300px;
    }
    #auth-container button {
      padding: 0.6em 1.2em;
      font-size: 1.2em;
      margin-top: 1em;
    }
  </style>
</head>
<body>

<div id="auth-container">
  <h2>请输入密码进入</h2>
  <input type="password" id="passwordInput" placeholder="密码" />
  <button onclick="checkPassword()">进入</button>
  <p id="auth-error" style="color:red;"></p>
</div>

<div id="main-container" class="hidden">
  <div class="settings">
    <label>总时间（分钟）:</label><input id="totalTime" type="number" value="10" min="1" max="60" />
    <label>释放机会概率（%）:</label><input id="chanceTrigger" type="number" value="30" min="0" max="100" />
    <label>释放成功概率（%）:</label><input id="chanceAllow" type="number" value="50" min="0" max="100" />
    <label>释放倒计时（秒）:</label><input id="releaseDuration" type="number" value="15" min="5" max="60" />
    <button onclick="startGame()">开始</button>
  </div>

  <div id="progress-container">
    <div id="status">等待开始...</div>
    <div id="progress"><div id="bar"></div></div>
  </div>
  <div id="countdown"></div>
</div>

<script>
  const correctPassword = "00000000";
  function checkPassword() {
    const input = document.getElementById("passwordInput").value;
    const errorText = document.getElementById("auth-error");
    if (input === correctPassword) {
      document.getElementById("auth-container").style.display = "none";
      document.getElementById("main-container").classList.remove("hidden");
    } else {
      errorText.textContent = "密码错误，请重试。";
    }
  }

  let totalDuration, chanceTrigger, chanceAllow, releaseDuration;
  let startTime;
  let mode = 'green';
  let bar, status, countdown;
  let interval;
  let inReleasePhase = false;

  const greenMessages = {
    early: ['慢慢撸，现在只是热身', '抓住你的鸡巴，从上到下撸动它'],
    mid: ['继续保持，别太快', '平稳前进'],
    late: ['坚持住，准备高潮', '深呼吸，保持冷静']
  };

  const redMessages = {
    early: ['暂停触碰，深呼吸'],
    mid: ['保持冷静，等待信号'],
    late: ['放松身体，控制自己']
  };

  function startGame() {
    totalDuration = parseInt(document.getElementById("totalTime").value) * 60 * 1000;
    chanceTrigger = parseInt(document.getElementById("chanceTrigger").value);
    chanceAllow = parseInt(document.getElementById("chanceAllow").value);
    releaseDuration = parseInt(document.getElementById("releaseDuration").value);

    bar = document.getElementById("bar");
    status = document.getElementById("status");
    countdown = document.getElementById("countdown");

    document.querySelector('.settings').classList.add('hidden');
    startTime = Date.now();

    status.innerText = "准备开始...";
    nextPhase();
  }

  function getPhaseProgress() {
    const elapsed = Date.now() - startTime;
    const progress = elapsed / totalDuration;
    if (progress <= 0.3) return 'early';
    if (progress <= 0.8) return 'mid';
    return 'late';
  }

  function getRandomMessage(mode) {
    const phase = getPhaseProgress();
    const messages = mode === 'green' ? greenMessages : redMessages;
    const msgList = messages[phase];
    return msgList[Math.floor(Math.random() * msgList.length)];
  }

  function nextPhase() {
    if (interval) clearInterval(interval);

    const now = Date.now();
    const elapsed = now - startTime;
    const progress = elapsed / totalDuration;
    const currentPhase = getPhaseProgress();

    if (progress > 1 && currentPhase === 'late' && mode === 'green') {
      if (Math.random() < chanceTrigger / 100) {
        inReleasePhase = true;
        const allow = Math.random() < chanceAllow / 100;
        if (allow) {
          status.innerText = '你可以释放了！';
        } else {
          status.innerText = '不太走运，不能释放';
        }
        startCountdown(releaseDuration, true);
        return;
      }
    }

    mode = (mode === 'green') ? 'red' : 'green';
    bar.style.background = (mode === 'green') ? 'green' : 'red';
    status.innerText = getRandomMessage(mode);

    const duration = getPhaseDuration(currentPhase, mode);
    startCountdown(duration, false);
  }

  function getPhaseDuration(phase, mode) {
    const ranges = {
      green: { early: [45, 60], mid: [15, 30], late: [5, 20] },
      red: { early: [10, 20], mid: [20, 30], late: [30, 60] }
    };
    const [min, max] = ranges[mode][phase];
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  function startCountdown(seconds, isFinal = false) {
    let current = seconds;
    countdown.innerText = current + " 秒";
    bar.style.width = '100%';

    interval = setInterval(() => {
      current--;
      countdown.innerText = current + " 秒";
      bar.style.width = (current / seconds * 100) + "%";

      if (current <= 0) {
        clearInterval(interval);
        if (isFinal) {
          status.innerText += "\n游戏结束。";
        } else {
          nextPhase();
        }
      }
    }, 1000);
  }
</script>

</body>
</html>
